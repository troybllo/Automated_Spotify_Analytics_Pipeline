{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.4", "generated_at": "2025-07-16T20:16:43.024881Z", "invocation_id": "6963841e-415d-47ea-9495-a2e193ce6aff", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-16T20:16:42.678372Z", "completed_at": "2025-07-16T20:16:42.688828Z"}, {"name": "execute", "started_at": "2025-07-16T20:16:42.689530Z", "completed_at": "2025-07-16T20:16:42.818622Z"}], "thread_id": "Thread-2", "execution_time": 0.1587083339691162, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.spotify_analytics.recently_played", "compiled": true, "compiled_code": "WITH source AS (\n    SELECT * FROM \"spotify_analytics\".\"raw_data\".\"recently_played\"\n),\n\ndeduplicated AS (\n    SELECT DISTINCT\n        played_at,\n        track_id,\n        track_name,\n        artist_ids,\n        artist_names,\n        album_id,\n        album_name,\n        duration_ms,\n        popularity,\n        explicit,\n        extracted_at,\n        load_timestamp,\n        ROW_NUMBER() OVER (\n            PARTITION BY played_at, track_id \n            ORDER BY load_timestamp DESC\n        ) as rn\n    FROM source\n    WHERE track_id IS NOT NULL\n)\n\nSELECT\n    md5(cast(coalesce(cast(played_at as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(track_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as play_id,\n    played_at,\n    track_id,\n    track_name,\n    artist_ids,\n    artist_names,\n    album_id,\n    album_name,\n    duration_ms,\n    ROUND(duration_ms / 1000.0 / 60, 2) as duration_minutes,\n    popularity,\n    explicit,\n    extracted_at,\n    load_timestamp\nFROM deduplicated\nWHERE rn = 1", "relation_name": "\"spotify_analytics\".\"analytics_staging\".\"recently_played\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-16T20:16:42.662047Z", "completed_at": "2025-07-16T20:16:42.725846Z"}, {"name": "execute", "started_at": "2025-07-16T20:16:42.726606Z", "completed_at": "2025-07-16T20:16:42.823007Z"}], "thread_id": "Thread-1", "execution_time": 0.16783428192138672, "adapter_response": {"_message": "SELECT 730", "code": "SELECT", "rows_affected": 730}, "message": "SELECT 730", "failures": null, "unique_id": "model.spotify_analytics.dim_times", "compiled": true, "compiled_code": "WITH date_spine AS (\n    \n\n\n\n\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * power(2, 0)\n     + \n    \n    p1.generated_number * power(2, 1)\n     + \n    \n    p2.generated_number * power(2, 2)\n     + \n    \n    p3.generated_number * power(2, 3)\n     + \n    \n    p4.generated_number * power(2, 4)\n     + \n    \n    p5.generated_number * power(2, 5)\n     + \n    \n    p6.generated_number * power(2, 6)\n     + \n    \n    p7.generated_number * power(2, 7)\n     + \n    \n    p8.generated_number * power(2, 8)\n     + \n    \n    p9.generated_number * power(2, 9)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 730\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n\n    cast('2024-01-01' as date) + ((interval '1 day') * (row_number() over (order by 1) - 1))\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast('2025-12-31' as date)\n\n)\n\nselect * from filtered\n\n\n),\n\nenriched AS (\n    SELECT\n        date_day,\n        EXTRACT(YEAR FROM date_day) as year,\n        EXTRACT(QUARTER FROM date_day) as quarter,\n        EXTRACT(MONTH FROM date_day) as month,\n        EXTRACT(WEEK FROM date_day) as week_of_year,\n        EXTRACT(DAY FROM date_day) as day_of_month,\n        EXTRACT(DOW FROM date_day) as day_of_week,\n        TO_CHAR(date_day, 'Month') as month_name,\n        TO_CHAR(date_day, 'Day') as day_name,\n        CASE \n            WHEN EXTRACT(DOW FROM date_day) IN (0, 6) THEN TRUE \n            ELSE FALSE \n        END as is_weekend,\n        CASE \n            WHEN EXTRACT(MONTH FROM date_day) IN (12, 1, 2) THEN 'Winter'\n            WHEN EXTRACT(MONTH FROM date_day) IN (3, 4, 5) THEN 'Spring'\n            WHEN EXTRACT(MONTH FROM date_day) IN (6, 7, 8) THEN 'Summer'\n            ELSE 'Fall'\n        END as season\n    FROM date_spine\n)\n\nSELECT \n    date_day::date as date_key,\n    year,\n    quarter,\n    month,\n    week_of_year,\n    day_of_month,\n    day_of_week,\n    TRIM(month_name) as month_name,\n    TRIM(day_name) as day_name,\n    is_weekend,\n    season\nFROM enriched", "relation_name": "\"spotify_analytics\".\"analytics_analytics\".\"dim_times\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-16T20:16:42.838555Z", "completed_at": "2025-07-16T20:16:42.844903Z"}, {"name": "execute", "started_at": "2025-07-16T20:16:42.850216Z", "completed_at": "2025-07-16T20:16:42.888660Z"}], "thread_id": "Thread-2", "execution_time": 0.06128954887390137, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.spotify_analytics.tracks", "compiled": true, "compiled_code": "WITH all_tracks AS (\n    -- Get tracks from recently played\n    SELECT DISTINCT\n        track_id,\n        track_name,\n        album_id,\n        album_name,\n        duration_ms,\n        popularity,\n        explicit\n    FROM \"spotify_analytics\".\"analytics_staging\".\"recently_played\"\n    \n    UNION\n    \n    -- Get tracks from top tracks\n    SELECT DISTINCT\n        track_id,\n        track_name,\n        album_id,\n        album_name,\n        duration_ms,\n        popularity,\n        explicit\n    FROM \"spotify_analytics\".\"raw_data\".\"top_tracks\"\n),\n\ndeduplicated AS (\n    SELECT\n        track_id,\n        track_name,\n        album_id,\n        album_name,\n        duration_ms,\n        popularity,\n        explicit,\n        ROW_NUMBER() OVER (\n            PARTITION BY track_id \n            ORDER BY popularity DESC NULLS LAST\n        ) as rn\n    FROM all_tracks\n    WHERE track_id IS NOT NULL\n)\n\nSELECT\n    track_id,\n    track_name,\n    album_id,\n    album_name,\n    duration_ms,\n    ROUND(duration_ms / 1000.0 / 60, 2) as duration_minutes,\n    popularity,\n    explicit,\n    CURRENT_TIMESTAMP as last_updated\nFROM deduplicated\nWHERE rn = 1", "relation_name": "\"spotify_analytics\".\"analytics_staging\".\"tracks\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-16T20:16:42.831722Z", "completed_at": "2025-07-16T20:16:42.838237Z"}, {"name": "execute", "started_at": "2025-07-16T20:16:42.841557Z", "completed_at": "2025-07-16T20:16:42.897214Z"}], "thread_id": "Thread-3", "execution_time": 0.0696251392364502, "adapter_response": {"_message": "SELECT 32", "code": "SELECT", "rows_affected": 32}, "message": "SELECT 32", "failures": null, "unique_id": "model.spotify_analytics.top_tracks_analysis", "compiled": true, "compiled_code": "WITH track_plays AS (\n    SELECT \n        track_id,\n        track_name,\n        artist_names,\n        COUNT(*) as play_count,\n        SUM(duration_minutes) as total_minutes_played,\n        AVG(popularity) as avg_popularity,\n        MAX(played_at) as last_played,\n        MIN(played_at) as first_played\n    FROM \"spotify_analytics\".\"analytics_staging\".\"recently_played\"\n    GROUP BY track_id, track_name, artist_names\n)\n\nSELECT \n    *,\n    ROUND(total_minutes_played / 60.0, 2) as total_hours_played,\n    CURRENT_DATE - DATE(last_played) as days_since_last_play\nFROM track_plays\nORDER BY play_count DESC", "relation_name": "\"spotify_analytics\".\"analytics_analytics\".\"top_tracks_analysis\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-16T20:16:42.835242Z", "completed_at": "2025-07-16T20:16:42.841081Z"}, {"name": "execute", "started_at": "2025-07-16T20:16:42.846131Z", "completed_at": "2025-07-16T20:16:42.914776Z"}], "thread_id": "Thread-4", "execution_time": 0.08709406852722168, "adapter_response": {"_message": "SELECT 50", "code": "SELECT", "rows_affected": 50}, "message": "SELECT 50", "failures": null, "unique_id": "model.spotify_analytics.fact_plays", "compiled": true, "compiled_code": "WITH plays AS (\n    SELECT * FROM \"spotify_analytics\".\"analytics_staging\".\"recently_played\"\n),\n\nenriched AS (\n    SELECT\n        p.play_id,\n        p.played_at,\n        p.track_id,\n        DATE(p.played_at) as date_key,\n        EXTRACT(HOUR FROM p.played_at) as hour_of_day,\n        EXTRACT(DOW FROM p.played_at) as day_of_week,\n        CASE \n            WHEN EXTRACT(DOW FROM p.played_at) IN (0, 6) THEN TRUE \n            ELSE FALSE \n        END as is_weekend,\n        CASE \n            WHEN EXTRACT(HOUR FROM p.played_at) BETWEEN 6 AND 11 THEN 'Morning'\n            WHEN EXTRACT(HOUR FROM p.played_at) BETWEEN 12 AND 17 THEN 'Afternoon'\n            WHEN EXTRACT(HOUR FROM p.played_at) BETWEEN 18 AND 22 THEN 'Evening'\n            ELSE 'Night'\n        END as time_of_day,\n        p.duration_minutes,\n        p.explicit as is_explicit,\n        p.load_timestamp\n    FROM plays p\n)\n\nSELECT * FROM enriched", "relation_name": "\"spotify_analytics\".\"analytics_analytics\".\"fact_plays\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-16T20:16:42.899699Z", "completed_at": "2025-07-16T20:16:42.905854Z"}, {"name": "execute", "started_at": "2025-07-16T20:16:42.906648Z", "completed_at": "2025-07-16T20:16:42.954954Z"}], "thread_id": "Thread-1", "execution_time": 0.058225393295288086, "adapter_response": {"_message": "SELECT 132", "code": "SELECT", "rows_affected": 132}, "message": "SELECT 132", "failures": null, "unique_id": "model.spotify_analytics.dim_tracks", "compiled": true, "compiled_code": "WITH tracks AS (\n    SELECT * FROM \"spotify_analytics\".\"analytics_staging\".\"tracks\"\n),\n\ntrack_artists AS (\n    SELECT DISTINCT\n        track_id,\n        SPLIT_PART(artist_names, ',', 1) as primary_artist_name\n    FROM \"spotify_analytics\".\"analytics_staging\".\"recently_played\"\n)\n\nSELECT t.track_id,\n    t.track_name,\n    t.album_id,\n    t.album_name,\n    ta.primary_artist_name,\n    t.duration_minutes,\n    t.popularity as popularity_score,\n    t.explicit as is_explicit,\n    t.last_updated\nFROM tracks t\nLEFT JOIN track_artists ta ON t.track_id = ta.track_id", "relation_name": "\"spotify_analytics\".\"analytics_analytics\".\"dim_tracks\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-16T20:16:42.962918Z", "completed_at": "2025-07-16T20:16:42.966052Z"}, {"name": "execute", "started_at": "2025-07-16T20:16:42.966859Z", "completed_at": "2025-07-16T20:16:43.011837Z"}], "thread_id": "Thread-3", "execution_time": 0.05332612991333008, "adapter_response": {"_message": "SELECT 20", "code": "SELECT", "rows_affected": 20}, "message": "SELECT 20", "failures": null, "unique_id": "model.spotify_analytics.top_tracks_monthly", "compiled": true, "compiled_code": "WITH monthly_plays AS (\n    SELECT\n        DATE_TRUNC('month', f.played_at) as month,\n        f.track_id,\n        t.track_name,\n        t.primary_artist_name,\n        COUNT(*) as play_count,\n        SUM(f.duration_minutes) as total_minutes\n    FROM \"spotify_analytics\".\"analytics_analytics\".\"fact_plays\" f\n    JOIN \"spotify_analytics\".\"analytics_analytics\".\"dim_tracks\" t ON f.track_id = t.track_id\n    GROUP BY 1, 2, 3, 4\n),\n\nranked AS (\n    SELECT\n        *,\n        ROW_NUMBER() OVER (PARTITION BY month ORDER BY play_count DESC) as monthly_rank\n    FROM monthly_plays\n)\n\nSELECT * FROM ranked\nWHERE monthly_rank <= 20\nORDER BY month DESC, monthly_rank", "relation_name": "\"spotify_analytics\".\"analytics_analytics\".\"top_tracks_monthly\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-16T20:16:42.960274Z", "completed_at": "2025-07-16T20:16:42.965822Z"}, {"name": "execute", "started_at": "2025-07-16T20:16:42.969938Z", "completed_at": "2025-07-16T20:16:43.014520Z"}], "thread_id": "Thread-2", "execution_time": 0.05654621124267578, "adapter_response": {"_message": "SELECT 2", "code": "SELECT", "rows_affected": 2}, "message": "SELECT 2", "failures": null, "unique_id": "model.spotify_analytics.listen_habits", "compiled": true, "compiled_code": "WITH daily_stats AS (\n    SELECT\n        f.date_key,\n        COUNT(DISTINCT f.track_id) as unique_tracks,\n        COUNT(*) as total_plays,\n        SUM(f.duration_minutes) as total_minutes,\n        AVG(t.popularity_score) as avg_track_popularity,\n        0.5 as happy_ratio,\n        0.5 as avg_energy,\n        0.5 as avg_danceability\n    FROM \"spotify_analytics\".\"analytics_analytics\".\"fact_plays\" f\n    JOIN \"spotify_analytics\".\"analytics_analytics\".\"dim_tracks\" t ON f.track_id = t.track_id\n    GROUP BY f.date_key\n)\n\nSELECT\n    ds.*,\n    dt.day_name,\n    dt.is_weekend,\n    dt.month_name,\n    dt.season,\n    ROUND(total_minutes / 60.0, 2) as total_hours\nFROM daily_stats ds\nJOIN \"spotify_analytics\".\"analytics_analytics\".\"dim_times\" dt ON ds.date_key = dt.date_key\nORDER BY ds.date_key DESC", "relation_name": "\"spotify_analytics\".\"analytics_analytics\".\"listen_habits\""}], "elapsed_time": 0.4823644161224365, "args": {"send_anonymous_usage_stats": true, "partial_parse_file_diff": true, "introspect": true, "log_level": "info", "select": [], "write_json": true, "quiet": false, "project_dir": "/usr/app/dbt", "log_level_file": "debug", "log_format_file": "debug", "defer": false, "use_colors_file": true, "populate_cache": true, "warn_error_options": {"include": [], "exclude": []}, "partial_parse": true, "exclude": [], "print": true, "log_format": "default", "show_resource_report": false, "cache_selected_only": false, "indirect_selection": "eager", "strict_mode": false, "favor_state": false, "use_colors": true, "macro_debugging": false, "log_file_max_bytes": 10485760, "profiles_dir": "/usr/app/dbt", "which": "run", "log_path": "/usr/app/dbt/logs", "invocation_command": "dbt run", "enable_legacy_logger": false, "vars": {}, "version_check": true, "static_parser": true, "printer_width": 80}}